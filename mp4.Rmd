---
title: "The movie industry has been rejecting single labels since the 1950s"
author: "Emma Livingston"
date: "December 1, 2017"
output:
  html_document:
    code_folding: hide
 #   theme: make it look different
---


```{r setup, include=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(mdsr)
library(RMySQL)
library(tidyverse)
db <- dbConnect_scidb(dbname = "imdb")
library(fivethirtyeight)
library(plotly)
library(RColorBrewer)
```

Have films gotten more greedy in their pursuit of an audience? By sorting a movie into genres, production companies are better able to attract viewers who know they will enjoy the movie and dissuade viewers who may not be interested. However, if they're selecting more genres, they're doing more of the former and less of the latter. We looked at the number of genres attached to movies over time to find out.

Film producers know that not everyone likes every genre, and they don't want to alienate potential new viewers by only having their movie fit in one box. For example, your typical superhero action movie has a romantic subplot, some comic relief, and a sci-fi or fantasy origin story. However, there's a difference between it being called an action movie and it being called a sci-fi/fantasy action rom-com. The former sounds fairly typical, and the latter sounds both like it has something for everyone and like it's a bit confused. But it might attract a wider audience by being firmly placed into all these different genres. And over time, producers have been learning this, since the average Hollywood movie has been placed into an increasing number of genres since the 1990s.

We started with data from the [IMDb database](/http://www.imdb.com/), which relies on user submissions that go through an [approval process](/https://help.imdb.com/article/contribution/contribution-information/when-will-my-update-be-added/GEKS9SBHDEHBAVC7?ref_=helpms_helpart_inline#). 

![title for image](link to image){width = 300px}, this also works with a gif
[text](link) - you can inspect this element, and change the color in the a{} element using something like #ff0000, 

CSS things:

<style>
body{
  font-size: 15px;
  font-family: Arial;
}
</style>
 
Right click on anything in an html file - inspect element - font-family, font-size
all comes in the tag body{}

for data tables = df_print: paged
or using package DT use datatable function

in ggplot +
labs("Title of my graph", subtitle = "additional info in subtitle", caption = "caption")

warning = FALSE might be your friend

footnote [^1]

[^1] text of the footnote (will show up at the bottom of the document)

```{r}
num_genres <- db %>%
  dbGetQuery("SELECT title.title, title.id, production_year, mi1.info AS genre, mi2.info AS country, sum(1) AS N
FROM title
JOIN movie_info AS mi1 ON title.id = mi1.movie_id
JOIN movie_info AS mi2 ON title.id = mi2.movie_id
WHERE mi1.info_type_id = 3 AND kind_id = 1 
AND mi2.info_type_id = 8 AND mi2.info = 'USA'
GROUP BY title.id
ORDER BY title, title.id;")
#This query makes use of the index on info_type_id in the movie_info table
#Group by movie to find the number of genres per movie

num_year <- db %>%
  dbGetQuery("SELECT production_year, info, sum(1) AS N
FROM movie_info
JOIN title ON title.id = movie_info.movie_id
WHERE info_type_id = 3 AND kind_id = 1
GROUP BY production_year
ORDER BY title, title.id;")
#This query also uses the index on the info_type_id in the movie_info table
#Group by production year to find the number of movies per year

joined <- num_genres %>%
  inner_join(num_year, by = "production_year") %>%
  filter(production_year <= 2026) %>%
  group_by(production_year) %>%
  summarize(avg_genres = mean(N.x))
#Here we combined the resulting tables from the above queries, filtered out any film with a production year greater than 2026 (because of the \href{http://www.imdb.com/title/tt5174640/}{film to be released in 2115}), and found the average number of genres per year.

past_joined <- joined %>%
  filter(production_year <= 2017)

ggplot(data = past_joined, aes(x = production_year, y = avg_genres)) +
  geom_line(size = 1.2) +
  geom_point(aes(x = 2017, y = 2.077276), shape = 20, size = 5, col = "cornflowerblue") +
  geom_text(aes(label = "2017", x = 2012, y = 1.75), col = "cornflowerblue") +
  geom_point(aes(x = 1947, y = 2.473159), shape = 20, size = 5, col = "cornflowerblue") +
  geom_text(aes(label = "1947", x = 1942, y = 2.25), col = "cornflowerblue") +
  ylab("Average Genres per Movie") +
  xlab("Production Year") +
  scale_x_continuous("", breaks = seq(from = 1880, to = 2020, by = 20))
``` 
```{r}
future <- joined %>%
  filter(production_year > 2017)
print(future)
```

```{r}
joined_bechdel <- num_genres %>%
  right_join(bechdel, by = "title") %>%
  filter(production_year == year) %>%
  mutate(Profit = domgross_2013 - budget_2013) %>%
  rename(Genres = N)
profit <- ggplot(data = joined_bechdel, aes(x = year, y = Profit, color = Genres, label = title)) +
  geom_smooth(size = 1.2, col = "black") +
  geom_point(alpha = 0.5) +
  scale_color_distiller(palette = "YlGnBu", direction = "-YlGnBu") +
  scale_y_continuous(breaks = seq(from = -500000000, to = 1500000000, by = 500000000), labels = c("-0.5", "0", "0.5", "1.0", "1.5")) + 
 xlab("Year") +
 ylab("Profit in 2013 Dollars (billions)") +
  theme(panel.background = element_rect(fill = "dark grey")) 
ggplotly(profit)
```


```{r}
ggplot(joined_bechdel, aes(x = Genres, y = Profit)) +
  geom_jitter() +
  scale_y_continuous(breaks = seq(from = -500000000, to = 1500000000, by = 500000000), labels = c("-0.5", "0", "0.5", "1.0", "1.5")) +
  ylab("Profit in 2013 Dollars (billions)")
```

